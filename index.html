<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Heart Model Clipping Viewer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="container">
        <button id="toggleSidebar" class="sidebar-collapsed">&#9654;</button>
        <div id="controls">
            <div class="control-group">
                <div class="header-row">
                    <label>Load Heart STL File:</label>
                    <button id="collapseBtn">&#9664;</button>
                </div>
                <input type="file" id="fileInput" accept=".stl" />
                <label for="fileInput" id="fileInputLabel">Choose File</label>
            </div>

            <div class="control-group">
                <label>X-Axis Clipping:</label>
                <div class="slider-container">
                    <input type="range" id="clipX" min="-25" max="25" step="0.1" value="25" />
                    <span class="value-display" id="clipXValue">25.0</span>
                </div>
            </div>

            <div class="control-group">
                <label>Y-Axis Clipping:</label>
                <div class="slider-container">
                    <input type="range" id="clipY" min="-25" max="25" step="0.1" value="25" />
                    <span class="value-display" id="clipYValue">25.0</span>
                </div>
            </div>

            <div class="control-group">
                <label>Z-Axis Clipping:</label>
                <div class="slider-container">
                    <input type="range" id="clipZ" min="-25" max="25" step="0.1" value="25" />
                    <span class="value-display" id="clipZValue">25.0</span>
                </div>
            </div>

            <div class="control-group">
                <div class="checkbox-container">
                    <input type="checkbox" id="enableClipping" checked />
                    <label for="enableClipping">Absolute Clipping</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="relativeCameraClipping" />
                    <label for="relativeCameraClipping">Relative Clipping</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="showPlanes" />
                    <label for="showPlanes">Clipping Plane</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="wireframe" />
                    <label for="wireframe">Wireframe Mode</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="showFloor" checked />
                    <label for="showFloor">Show Floor</label>
                </div>
            </div>

            <div class="control-group">
                <button onclick="resetView()">Reset View</button>
                <button onclick="resetClipping()">Reset Clipping</button>
            </div>
        </div>

        <div id="loadingIndicator">
            <div class="spinner"></div>
            <div>Loading model...</div>
        </div>

        <!-- Right sidebar for NRRD controls -->
        <button id="toggleNrrdSidebar" class="sidebar-collapsed">&#9664;</button>
        <div id="nrrdControls">
            <div class="control-group">
                <div class="header-row">
                    <label>Load NRRD File:</label>
                    <button id="collapseNrrdBtn">&#9654;</button>
                </div>
                <input type="file" id="nrrdFileInput" accept=".nrrd" />
                <label for="nrrdFileInput" id="nrrdFileInputLabel">Choose File</label>
            </div>

            <div class="control-group">
                <label>X-Axis Clipping:</label>
                <div class="slider-container">
                    <input type="range" id="nrrdClipX" min="-25" max="25" step="0.1" value="25" />
                    <span class="value-display" id="nrrdClipXValue">25.0</span>
                </div>
            </div>

            <div class="control-group">
                <label>Y-Axis Clipping:</label>
                <div class="slider-container">
                    <input type="range" id="nrrdClipY" min="-25" max="25" step="0.1" value="25" />
                    <span class="value-display" id="nrrdClipYValue">25.0</span>
                </div>
            </div>

            <div class="control-group">
                <label>Z-Axis Clipping:</label>
                <div class="slider-container">
                    <input type="range" id="nrrdClipZ" min="-25" max="25" step="0.1" value="25" />
                    <span class="value-display" id="nrrdClipZValue">25.0</span>
                </div>
            </div>
        </div>

        <!-- FPS Counter -->
        <div id="fpsCounter">FPS: 0</div>

        <!-- Relative perspective clipping control -->
        <div id="relativeClippingControls">
            <div class="relative-control-row">
                <label>Clipping Depth:</label>
                <input type="range" id="relativeDepth" min="-30" max="30" step="0.1" value="0" />
                <span class="value-display" id="relativeDepthValue">0.0</span>
            </div>
            <div class="relative-control-row">
                <div class="checkbox-container">
                    <input type="checkbox" id="lockAngle" />
                    <label for="lockAngle">Lock Cutting Plane Angle</label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="autoDepth" />
                    <label for="autoDepth">Auto</label>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.161.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
            }
        }
    </script>
    <script type="module" src="script.js"></script>
</body>
</html>
